<%- layout("/layouts/boilerplate") %>

<div class="container mt-4">
  <h2>All Bookings (Admin Panel)</h2>
  <br>

  <% if(bookings.length === 0) { %>
    <div class="alert alert-info">
      No bookings yet.
    </div>
  <% } else { %>
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th>Customer</th>
            <th>Listing</th>
            <th>Check-in</th>
            <th>Check-out</th>
            <th>Guests</th>
            <th>Total Price</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% for(let booking of bookings) { %>
            <% if(booking.listing && booking.customer) { %>
            <tr>
              <td>
                <strong><%= booking.customer.username %></strong><br>
                <small><%= booking.customer.email %></small>
              </td>
              <td>
                <a href="/listings/<%= booking.listing._id %>">
                  <%= booking.listing.title %>
                </a><br>
                <small><%= booking.listing.location %></small>
              </td>
              <td><%= new Date(booking.checkIn).toLocaleDateString() %></td>
              <td><%= new Date(booking.checkOut).toLocaleDateString() %></td>
              <td><%= booking.guests %></td>
              <td>â‚¹<%= booking.totalPrice.toLocaleString("en-IN") %></td>
              <td>
                <% if(booking.status === 'pending') { %>
                  <span class="badge bg-warning text-dark">Pending</span>
                <% } else if(booking.status === 'confirmed') { %>
                  <span class="badge bg-success">Confirmed</span>
                <% } else { %>
                  <span class="badge bg-danger">Rejected</span>
                <% } %>
              </td>
              <td>
                <% if(booking.status === 'pending') { %>
                  <form action="/bookings/<%= booking._id %>/confirm" method="POST" style="display: inline;" onsubmit="return confirm('Confirm this booking?')">
                    <button class="btn btn-sm btn-success" title="Confirm Booking">
                      <i class="fa-solid fa-check"></i> Confirm
                    </button>
                  </form>
                  <form action="/bookings/<%= booking._id %>/reject" method="POST" style="display: inline;" onsubmit="return confirm('Reject this booking?')">
                    <button class="btn btn-sm btn-danger" title="Reject Booking">
                      <i class="fa-solid fa-times"></i> Reject
                    </button>
                  </form>
                <% } else { %>
                  <span class="text-muted">
                    <%= booking.status.charAt(0).toUpperCase() + booking.status.slice(1) %>
                  </span>
                <% } %>
                <!-- Delete button for admin -->
                <form action="/bookings/<%= booking._id %>/admin-delete?_method=DELETE" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to permanently delete this booking?');">
                  <button class="btn btn-sm btn-outline-danger" title="Delete Booking">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </form>
              </td>
            </tr>
            <% } %>
          <% } %>
        </tbody>
      </table>
    </div>
  <% } %>
</div>
